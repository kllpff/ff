# Руководство по развертыванию

Разверните FF Framework в production.

## Чек-лист перед развертыванием

- ✅ Установить `APP_DEBUG=false`
- ✅ Установить `APP_ENV=production`
- ✅ Сгенерировать сильный `APP_KEY`
- ✅ Обновить учетные данные базы данных
- ✅ Включить HTTPS (SSL)
- ✅ Установить правильные права доступа к файлам
- ✅ Запустить миграции на сервере
- ✅ Настроить веб-сервер

## Настройка окружения

1. **SSH к серверу:**
   ```bash
   ssh user@yourserver.com
   ```

2. **Клонировать репозиторий:**
   ```bash
   cd /var/www
   git clone https://github.com/kllpff/ff.git
   cd ff
   ```

3. **Установить зависимости:**
   ```bash
   composer install --no-dev
   ```

4. **Настроить окружение:**
   ```bash
   cp .env.example .env
   # Отредактировать .env с production значениями
   ```

5. **Сгенерировать ключ:**
   ```bash
   php -r "echo 'APP_KEY=' . bin2hex(random_bytes(32)) . PHP_EOL;" >> .env
   ```

6. **Запустить миграции:**
   ```bash
   php migrate.php
   ```

7. **Установить права доступа:**
   ```bash
   sudo chown -R www-data:www-data .
   sudo chmod -R 755 .
   sudo chmod -R 775 storage tmp
   ```

## Конфигурация веб-сервера

Смотрите [Руководство по установке](./INSTALLATION.md) для конфигурации Nginx и Apache.

### Важно: Настройте доверенные прокси

Если ваше приложение находится за обратным прокси (nginx, Cloudflare, AWS ALB, Docker), **вы должны настроить доверенные прокси**:

```bash
# Добавьте в файл .env
TRUSTED_PROXIES=192.168.1.1,10.0.0.0/8  # IP ваших прокси

# Или настройте в config/app.php
'trusted_proxies' => [
    '192.168.1.1',
    '10.0.0.0/8',
    '172.16.0.0/12',
    '192.168.0.0/16'
],
```

**Безопасность**: Никогда не используйте `TRUSTED_PROXIES=*` в продакшене!

Смотрите [Руководство по доверенным прокси](./TRUSTED_PROXIES.md) для подробной конфигурации.

## SSL сертификат

Используйте Let's Encrypt для бесплатного SSL:

```bash
sudo certbot certonly --webroot -w /var/www/ff/public -d example.com
```

Настройте веб-сервер для использования сертификата.

## Мониторинг

Мониторьте ваше приложение в production:

- Регулярно проверяйте логи ошибок
- Мониторьте место на диске и память
- Настройте автоматические резервные копии
- Мониторьте время отклика
- Отслеживайте частоту ошибок

## Оптимизация

Для production:

- Включите кеширование opcode (OPcache)
- Используйте CDN для статических ресурсов
- Включите сжатие gzip
- Кешируйте часто запрашиваемые данные
- Оптимизируйте запросы к базе данных

---

[← Назад к документации](./README.md)
